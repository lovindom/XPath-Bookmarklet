window.onload=function(){(function(){function c(e){this.message=e;$("#output").val(e);this.name="[XPathException]"}function p(e){var t,n,r,i,s,o,u,a,l,h="",p=[],d=0,v=0;e=e.replace(/contains\s*\(\s*concat\(["']\s+["']\s*,\s*@class\s*,\s*["']\s+["']\)\s*,\s*["']\s+([a-zA-Z0-9-_]+)\s+["']\)/gi,'@class="$1"');if(typeof e=="undefined"||e.replace(/[\s-_=]/g,"")===""||e.length!==e.replace(/[-_\w:.]+\(\)\s*=|=\s*[-_\w:.]+\(\)|\sor\s|\sand\s|\[(?:[^\/\]]+[\/\[]\/?.+)+\]|starts-with\(|\[.*last\(\)\s*[-\+<>=].+\]|number\(\)|not\(|count\(|text\(|first\(|normalize-space|[^\/]following-sibling|concat\(|descendant::|parent::|self::|child::|/gi,"").length){throw new c("Invalid or unsupported XPath: "+e)}var m=e.split("|");while(m[d]){t=new RegExp(f,"gi");l=[];while(a=t.exec(m[d])){if(!a&&v===0){throw new c("Invalid or unsupported XPath: "+e)}n={node:a[5],idvalue:a[12]||a[3],nav:a[4],tag:a[5],matched:a[7],mattr:a[10]||a[14],mvalue:a[12]||a[16],contained:a[13],cattr:a[14],cvalue:a[16],nth:a[18]};if(v!=0&&n["nav"]){if(~n["nav"].indexOf("following-sibling::"))i=" + ";else i=n["nav"]=="//"?" ":" > "}else{i=""}s=n["tag"]==="*"?"":n["tag"]||"";if(n["contained"]){if(n["cattr"].indexOf("@")===0){o="["+n["cattr"].replace(/^@/,"")+"*="+n["cvalue"]+"]"}else{throw new c("Invalid or unsupported XPath attribute: "+n["cattr"])}}else if(n["matched"]){switch(n["mattr"]){case"@id":o="#"+n["mvalue"].replace(/^\s+|\s+$/,"").replace(/\s/g,"#");break;case"@class":o="."+n["mvalue"].replace(/^\s+|\s+$/,"").replace(/\s/g,".");break;case"text()":case".":throw new c("Invalid or unsupported XPath attribute: "+n["mattr"]);default:if(n["mattr"].indexOf("@")!==0){throw new c("Invalid or unsupported XPath attribute: "+n["mattr"])}if(n["mvalue"].indexOf(" ")!==-1){n["mvalue"]='"'+n["mvalue"].replace(/^\s+|\s+$/,"")+'"'}o="["+n["mattr"].replace("@","")+"="+n["mvalue"]+"]";break}}else if(n["idvalue"])o="#"+n["idvalue"].replace(/\s/,"#");else o="";if(n["nth"]){if(n["nth"].indexOf("last")===-1){if(isNaN(parseInt(n["nth"],10))){throw new c("Invalid or unsupported XPath attribute: "+n["nth"])}u=parseInt(n["nth"],10)!==1?":nth-of-type("+n["nth"]+")":":first-of-type"}else{u=":last-of-type"}}else{u=""}h=i+s+o+u;l.push(h);v++}r=l.join("");if(r===""){throw new c("Invalid or unsupported XPath: "+n["node"])}p.push(r);d++}return p.join(", ")}var t=document.getElementsByTagName("*"),r=window.getComputedStyle(document.body,null).paddingLeft,i=document.createElement("div"),s=false,o=(new Date).getTime();i.setAttribute("style","background-color: #EEE; border-bottom: 2px solid #AAA; font-family: helvetica, sans-serif; color: #777; font-size: 16px; -webkit-box-shadow: 0px 5px 10px rgba(33, 33, 33, .7); position: fixed; height: 20px; top: 0px; left: "+r+"; width: 100%; text-align: center; padding: 10px; opacity: .01; z-index: 99999999");i.id="pki-xpath-output";i.innerHTML="<b>Hold down shift and hover over a node to view it's XPath.</b>";document.body.style.marginTop=window.getComputedStyle(document.body,null).paddingTop;document.body.appendChild(i);var u=setInterval(function(){var e=parseInt(document.body.style.marginTop)+1,t=(new Date).getTime()-o;if(parseInt(document.body.style.marginTop)<60){document.body.style.marginTop=e+e*.09+"px";i.style.opacity=i.style.opacity*1.2}else{Math.floor(i.style.opacity);clearInterval(u)}},10);document.onkeydown=function(e){if(e.keyCode&&e.keyCode===16||e.shiftKey||e.keyIdentifier&&e.keyIdentifer==="Shift"){s=true}};document.onkeyup=function(e){if(e.keyCode&&e.keyCode===16||e.shiftKey||e.keyIdentifier&&e.keyIdentifer==="Shift"){s=false}};for(e in t){if(!t[e].onmouseover){t[e].onmouseover=function(e){if(s===true){var t=e.target,r=undefined,o="";while(t.parentNode){if(t.id==="pki-xpath-output")return false;var u=t.parentNode.childNodes,a=0,f=1;if(t.id.length>0){o=o.length>0?"//"+t.nodeName+"[@id='"+t.id+"']"+"/"+o:"//"+t.nodeName+"[@id='"+t.id+"']";i.innerHTML="<b>"+o.toLowerCase()+"</b>";return false}for(n in u){if(u[n].nodeName===t.nodeName){a++;if(u[n]===t){f=a}}}if(a>1){o=o.length>0?t.nodeName+"["+f+"]/"+o:t.nodeName+"["+f+"]"}else{o=o.length>0?t.nodeName+"/"+o:t.nodeName}t=t.parentNode}i.innerHTML="<b>"+o.toLowerCase()+"</b>"}e.stopPropagation()}}}$("body").mouseover(function(e){if(e.shiftKey){css=p($("#pki-xpath-output").text());$(css).css("background-color","red")}}).mouseout(function(){$(css).removeClass("elm-pckr-bcg-on")});var a={tag:"([a-zA-Z][a-zA-Z0-9]{0,10}|\\*)",attribute:"[.a-zA-Z_:][-\\w:.]*(\\(\\))?)",value:"\\s*[\\w/:][-/\\w\\s,:;.]*"};var f="(?P<node>"+"("+"^id\\([\"\\']?(?P<idvalue>%(value)s)[\"\\']?\\)"+"|"+"(?P<nav>//?(?:following-sibling::)?)(?P<tag>%(tag)s)"+"(\\[("+"(?P<matched>(?P<mattr>@?%(attribute)s=[\"\\'](?P<mvalue>%(value)s))[\"\\']"+"|"+"(?P<contained>contains\\((?P<cattr>@?%(attribute)s,\\s*[\"\\'](?P<cvalue>%(value)s)[\"\\']\\))"+")\\])?"+"(\\[\\s*(?P<nth>\\d|last\\(\\s*\\))\\s*\\])?"+")"+")";for(var l in a)f=f.replace(new RegExp("%\\("+l+"\\)s","gi"),a[l]);f=f.replace(/\?P<node>|\?P<idvalue>|\?P<nav>|\?P<tag>|\?P<matched>|\?P<mattr>|\?P<mvalue>|\?P<contained>|\?P<cattr>|\?P<cvalue>|\?P<nth>/gi,"");var h=window.console.log;})()}
